<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Wavelength – Mobile (Solo local)</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:rgba(255,255,255,.06);
      --border:rgba(255,255,255,.12);
      --text:#f9fafb;
      --muted:rgba(255,255,255,.72);
      --accent:#f97316;
      --good:#22c55e;
      --warn:#fbbf24;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 550px at 20% 0%, rgba(249,115,22,.10), transparent 55%),
        radial-gradient(900px 550px at 80% 15%, rgba(59,130,246,.10), transparent 55%),
        var(--bg);
      padding: 12px;
      display:flex;
      justify-content:center;
    }
    .app{
      width: min(720px, 100%);
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .panel{
      border:1px solid var(--border);
      background: var(--panel);
      border-radius:16px;
      padding:14px;
      backdrop-filter: blur(6px);
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:space-between; }
    h1{ margin:0; font-size:18px; }
    .muted{ color:var(--muted); font-size:12px; line-height:1.35; }
    .btn{
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.18);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
      user-select:none;
      transition: transform .08s ease, border-color .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(249,115,22,.45); }
    .btn:active{ transform: translateY(0); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(249,115,22,.95), rgba(249,115,22,.80));
      border-color: rgba(249,115,22,.85);
      color:#0b1220;
      box-shadow: 0 10px 22px rgba(249,115,22,.18);
    }
    .btn-ghost{ background: rgba(0,0,0,.10); }
    .bigPair{
      font-weight:900;
      font-size:18px;
      text-align:center;
      padding: 10px 8px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
    }
    .bigPair span{
      display:inline-block;
      min-width: 110px;
    }

    /* Target */
    .targetWrap{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .bar{
      position:relative;
      height: 62px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.12);
      background:
        linear-gradient(90deg, rgba(59,130,246,.14), rgba(249,115,22,.14));
      overflow:hidden;
      touch-action:none;
    }

    .tick{
      position:absolute;
      top: 8px;
      bottom: 8px;
      width: 1px;
      background: rgba(255,255,255,.12);
    }
    .zone{
      position:absolute;
      top: 10px;
      bottom: 10px;
      border-radius: 999px;
      background: rgba(34,197,94,.10);
      border: 1px solid rgba(34,197,94,.18);
      display:none;
    }

    .needle{
      position:absolute;
      top: -6px;
      bottom: -6px;
      width: 4px;
      border-radius: 999px;
      background: rgba(255,255,255,.90);
      box-shadow: 0 10px 24px rgba(0,0,0,.45);
      transform: translateX(-2px);
    }
    .needle::after{
      content:"";
      position:absolute;
      top:-6px;
      left:50%;
      transform: translateX(-50%);
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.90);
    }

    .labelRow{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color: rgba(255,255,255,.82);
      margin-top:-2px;
    }

    /* Screens */
    .screen{ display:none; }
    .screen.show{ display:block; }
    .secret{
      padding:10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .secret .value{
      font-size:28px;
      font-weight:950;
      letter-spacing:.2px;
    }
    .scoreBox{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.16);
    }
    .scoreBox .pts{
      font-size:22px;
      font-weight:950;
    }
  </style>
</head>

<body>
  <div class="app">

    <div class="panel">
      <div class="row">
        <h1>Wavelength – Mobile</h1>
        <div class="row" style="gap:8px; justify-content:flex-end;">
          <button id="btn-new" class="btn btn-ghost">Nouvelle manche</button>
          <button id="btn-switch" class="btn btn-primary">Passer au Psychic</button>
        </div>
      </div>
      <div class="muted" id="subtitle"></div>
    </div>

    <div class="panel">
      <div class="bigPair" id="pair">Chargement…</div>
    </div>

    <!-- Psychic screen -->
    <div class="panel screen" id="screen-psychic">
      <div class="row">
        <div style="font-weight:900;">Écran Psychic (secret)</div>
        <div class="muted">Donne un indice. Puis passe le téléphone.</div>
      </div>

      <div class="secret">
        <div class="muted">Position cible (0–100)</div>
        <div class="value" id="secretValue">—</div>
        <div class="muted">La zone de score est calculée automatiquement autour du secret.</div>
      </div>

      <div class="targetWrap" style="margin-top:12px;">
        <div class="bar" id="barPsychic">
          <!-- ticks -->
        </div>
        <div class="labelRow">
          <div id="leftLabelP">Gauche</div>
          <div id="rightLabelP">Droite</div>
        </div>
      </div>

      <div class="muted" style="margin-top:10px;">
        Astuce : plus tu es proche du centre de la zone, plus tu marques de points.
      </div>
    </div>

    <!-- Team screen -->
    <div class="panel screen" id="screen-team">
      <div class="row">
        <div style="font-weight:900;">Écran Équipe</div>
        <div class="muted">Placez le curseur selon l’indice.</div>
      </div>

      <div class="targetWrap" style="margin-top:12px;">
        <div class="bar" id="barTeam"></div>
        <div class="labelRow">
          <div id="leftLabelT">Gauche</div>
          <div id="rightLabelT">Droite</div>
        </div>
      </div>

      <div class="row" style="margin-top:12px;">
        <button id="btn-reveal" class="btn btn-green">Révéler & scorer</button>
        <button id="btn-hide" class="btn btn-ghost">Cacher la zone</button>
      </div>

      <div class="scoreBox" style="margin-top:12px;">
        <div>
          <div class="muted">Votre placement</div>
          <div style="font-weight:900;" id="guessValue">—</div>
        </div>
        <div style="text-align:right;">
          <div class="muted">Points</div>
          <div class="pts" id="points">—</div>
        </div>
      </div>

      <div class="muted" style="margin-top:10px;">
        Note : le secret n’est visible qu’après révélation.
      </div>
    </div>

  </div>

  <script>
    // Paires (V1) — tu peux en ajouter autant que tu veux
    const PAIRS = [
      ["Froid", "Chaud"],
      ["Mauvais film", "Chef-d’œuvre"],
      ["Inconnu", "Très célèbre"],
      ["Ennuyeux", "Passionnant"],
      ["Sous-coté", "Sur-coté"],
      ["Moche", "Magnifique"],
      ["Pas du tout utile", "Indispensable"],
      ["Calme", "Énervant"],
      ["Trash", "Classe"],
      ["Simple", "Complexe"],
      ["Ringard", "Stylé"],
      ["Impossible", "Facile"]
    ];

    const els = {
      subtitle: document.getElementById("subtitle"),
      pair: document.getElementById("pair"),
      btnNew: document.getElementById("btn-new"),
      btnSwitch: document.getElementById("btn-switch"),
      screenPsychic: document.getElementById("screen-psychic"),
      screenTeam: document.getElementById("screen-team"),
      leftLabelP: document.getElementById("leftLabelP"),
      rightLabelP: document.getElementById("rightLabelP"),
      leftLabelT: document.getElementById("leftLabelT"),
      rightLabelT: document.getElementById("rightLabelT"),
      barPsychic: document.getElementById("barPsychic"),
      barTeam: document.getElementById("barTeam"),
      secretValue: document.getElementById("secretValue"),
      guessValue: document.getElementById("guessValue"),
      btnReveal: document.getElementById("btn-reveal"),
      btnHide: document.getElementById("btn-hide"),
      points: document.getElementById("points"),
    };

    const state = {
      mode: "team", // "psychic" | "team"
      pair: PAIRS[0],
      secret: 50,       // 0..100
      zoneWidth: 22,    // largeur totale de zone (0..100)
      guess: 50,        // 0..100
      revealed: false
    };

    function rndInt(min, max){
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }
    function clamp(v, a, b){
      return Math.max(a, Math.min(b, v));
    }

    function pickPair(){
      state.pair = PAIRS[rndInt(0, PAIRS.length-1)];
    }

    function newRound(){
      pickPair();
      state.secret = rndInt(0, 100);
      state.zoneWidth = rndInt(18, 26);
      state.guess = 50;
      state.revealed = false;
      els.points.textContent = "—";
      els.guessValue.textContent = "—";
      renderAll();
    }

    function setMode(mode){
      state.mode = mode;
      els.screenPsychic.classList.toggle("show", mode === "psychic");
      els.screenTeam.classList.toggle("show", mode === "team");
      els.btnSwitch.textContent = (mode === "team") ? "Passer au Psychic" : "Passer à l’Équipe";
      els.subtitle.textContent = (mode === "team")
        ? "L’équipe place le curseur. Révélez pour voir le secret et scorer."
        : "Le Psychic voit le secret. Donne un indice puis passe le téléphone.";
      renderAll();
    }

    // Scoring simplifié 4/3/2/1/0
    // On crée 4 “bandes” concentriques dans la zoneWidth
    function computePoints(secret, guess, zoneWidth){
      const half = zoneWidth / 2;
      const d = Math.abs(guess - secret);

      // 4 paliers (centre => 4)
      const t1 = half * 0.25;
      const t2 = half * 0.50;
      const t3 = half * 0.75;
      const t4 = half * 1.00;

      if(d <= t1) return 4;
      if(d <= t2) return 3;
      if(d <= t3) return 2;
      if(d <= t4) return 1;
      return 0;
    }

    function barSetup(barEl){
      barEl.innerHTML = "";

      // ticks
      for(let i=1;i<10;i++){
        const tick = document.createElement("div");
        tick.className = "tick";
        tick.style.left = (i*10) + "%";
        barEl.appendChild(tick);
      }

      const zone = document.createElement("div");
      zone.className = "zone";
      zone.dataset.role = "zone";
      barEl.appendChild(zone);

      const needle = document.createElement("div");
      needle.className = "needle";
      needle.dataset.role = "needle";
      barEl.appendChild(needle);
    }

    function barElements(barEl){
      return {
        zone: barEl.querySelector('[data-role="zone"]'),
        needle: barEl.querySelector('[data-role="needle"]')
      };
    }

    function positionZone(barEl, secret, zoneWidth, visible){
      const { zone } = barElements(barEl);
      const half = zoneWidth / 2;
      const left = clamp(secret - half, 0, 100);
      const right = clamp(secret + half, 0, 100);
      zone.style.left = left + "%";
      zone.style.width = (right - left) + "%";
      zone.style.display = visible ? "block" : "none";
    }

    function positionNeedle(barEl, value){
      const { needle } = barElements(barEl);
      needle.style.left = clamp(value, 0, 100) + "%";
    }

    function renderPair(){
      const [L,R] = state.pair;
      els.pair.innerHTML = `<span>${L}</span> ↔ <span>${R}</span>`;
      els.leftLabelP.textContent = L;
      els.rightLabelP.textContent = R;
      els.leftLabelT.textContent = L;
      els.rightLabelT.textContent = R;
    }

    function renderBars(){
      // Psychic: voit zone + secret + aiguille sur secret
      positionZone(els.barPsychic, state.secret, state.zoneWidth, true);
      positionNeedle(els.barPsychic, state.secret);

      // Team: ne voit zone que si revealed
      positionZone(els.barTeam, state.secret, state.zoneWidth, state.revealed);
      positionNeedle(els.barTeam, state.guess);
    }

    function renderAll(){
      renderPair();
      els.secretValue.textContent = state.secret;
      renderBars();
    }

    function setGuessFromEvent(barEl, ev){
      const rect = barEl.getBoundingClientRect();
      const clientX = (ev.touches && ev.touches[0]) ? ev.touches[0].clientX : ev.clientX;
      const x = clamp(clientX - rect.left, 0, rect.width);
      const pct = Math.round((x / rect.width) * 100);
      state.guess = pct;
      els.guessValue.textContent = pct;
      positionNeedle(barEl, pct);
    }

    // Events
    els.btnNew.onclick = ()=> newRound();

    els.btnSwitch.onclick = ()=>{
      setMode(state.mode === "team" ? "psychic" : "team");
    };

    // Drag/click on team bar
    let dragging = false;
    els.barTeam.addEventListener("pointerdown", (e)=>{
      dragging = true;
      els.barTeam.setPointerCapture(e.pointerId);
      setGuessFromEvent(els.barTeam, e);
    });
    els.barTeam.addEventListener("pointermove", (e)=>{
      if(!dragging) return;
      setGuessFromEvent(els.barTeam, e);
    });
    els.barTeam.addEventListener("pointerup", ()=>{
      dragging = false;
    });

    els.btnReveal.onclick = ()=>{
      state.revealed = true;
      const pts = computePoints(state.secret, state.guess, state.zoneWidth);
      els.points.textContent = pts + " / 4";
      renderBars();
    };

    els.btnHide.onclick = ()=>{
      state.revealed = false;
      els.points.textContent = "—";
      renderBars();
    };

    // init
    barSetup(els.barPsychic);
    barSetup(els.barTeam);
    newRound();
    setMode("team");
  </script>
</body>
</html>