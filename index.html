<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Wavelength – Mobile</title>

<style>
:root{
  --bg:#0b1220;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.14);
  --text:#f9fafb;
  --muted:rgba(255,255,255,.70);
  --accent:#f97316;
  --green:#22c55e;
  --orange:#f59e0b;
  --red:#ef4444;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Arial,sans-serif;
  background: radial-gradient(900px 500px at 20% 0%, rgba(249,115,22,.12), transparent 60%),
              radial-gradient(900px 500px at 80% 10%, rgba(59,130,246,.10), transparent 60%),
              var(--bg);
  color:var(--text);
  padding:12px;
  display:flex;
  justify-content:center;
}

.app{
  width:min(820px,100%);
  display:flex;
  flex-direction:column;
  gap:12px;
}

.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
}

.turn{
  text-align:center;
  font-size:26px;
  font-weight:900;
}

.subturn{
  text-align:center;
  font-size:14px;
  color:var(--muted);
}

.pair{
  display:flex;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
  font-weight:900;
  font-size:18px;
}

.pill{
  padding:8px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid var(--border);
  min-width:180px;
  text-align:center;
}

canvas{
  width:100%;
  max-width:620px;
  margin:auto;
  display:block;
  border-radius:18px;
  background:rgba(0,0,0,.18);
  border:1px solid var(--border);
  touch-action:none;
}

.controls{
  display:flex;
  justify-content:center;
}

button{
  padding:12px 18px;
  border-radius:999px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.18);
  color:var(--text);
  font-weight:900;
  cursor:pointer;
}

button.primary{
  background:linear-gradient(180deg,#f97316,#fb923c);
  color:#111;
}

.sliderWrap{
  max-width:620px;
  margin:12px auto 0 auto;
  padding:10px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.14);
}

input[type="range"]{
  width:100%;
  accent-color:var(--accent);
}

.hidden{display:none}

.scoreline{
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.16);
}
</style>
</head>

<body>
<div class="app">

  <div class="panel">
    <div class="turn" id="turnTitle">Wavelength</div>
    <div class="subturn" id="turnSub"></div>
  </div>

  <div class="panel">
    <div class="pair" id="pair"></div>
  </div>

  <div class="panel">
    <canvas id="canvas" width="900" height="520"></canvas>

    <div id="sliderWrap" class="sliderWrap hidden">
      <input id="slider" type="range" min="0" max="100" value="50">
    </div>
  </div>

  <div class="panel controls">
    <button id="actionBtn" class="primary">Nouvelle manche</button>
  </div>

  <div class="panel">
    <h3>Scores</h3>
    <div id="scores"></div>
  </div>

</div>

<script>
/* ===== THEMES ===== */
const PAIRS = [
  ["Humour gênant","Humour masterclass"],
  ["Rappeur inconnu","Rappeur légendaire"],
  ["Jeu vidéo nul","Jeu vidéo culte"],
  ["Film éclaté","Film incroyable"]
];

/* ===== STATE ===== */
let players = [
  {id:1,name:"Alice",color:"#60a5fa",score:0},
  {id:2,name:"Bob",color:"#f87171",score:0},
  {id:3,name:"Charly",color:"#4ade80",score:0}
];
let psychicIndex = 0;
let phase = "psychic";
let secret = Math.floor(Math.random()*101);
let guesses = {};
let currentNeedle = 50;
let roundScored = false;
let roundPair = PAIRS[Math.floor(Math.random()*PAIRS.length)];

/* ===== DOM ===== */
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const slider = document.getElementById("slider");
const sliderWrap = document.getElementById("sliderWrap");
const btn = document.getElementById("actionBtn");
const pairDiv = document.getElementById("pair");
const scoresDiv = document.getElementById("scores");
const turnTitle = document.getElementById("turnTitle");
const turnSub = document.getElementById("turnSub");

/* ===== UTILS ===== */
const clamp=(v,a,b)=>Math.max(a,Math.min(b,v));
const angleFromPct=p=>Math.PI-(p/100)*Math.PI;

/* ===== DRAW ===== */
function drawZone(delta,color,cx,cy,r){
  const a1=angleFromPct(clamp(secret-delta,0,100));
  const a2=angleFromPct(clamp(secret+delta,0,100));
  ctx.strokeStyle=color;
  ctx.lineWidth=44;
  ctx.lineCap="butt";
  ctx.beginPath();
  ctx.arc(cx,cy,r,a1,a2,false);
  ctx.stroke();
}

function drawNeedle(pct,color,width,cx,cy,r){
  const a=angleFromPct(pct);
  ctx.strokeStyle=color;
  ctx.lineWidth=width;
  ctx.beginPath();
  ctx.moveTo(cx,cy);
  ctx.lineTo(cx+Math.cos(a)*r, cy-Math.sin(a)*r);
  ctx.stroke();
}

function draw(mode){
  ctx.clearRect(0,0,900,520);
  const cx=450,cy=460,r=320;

  ctx.strokeStyle="rgba(255,255,255,.18)";
  ctx.lineWidth=60;
  ctx.beginPath();
  ctx.arc(cx,cy,r,Math.PI,0,false);
  ctx.stroke();

  if(mode==="reveal"){
    drawZone(8,"rgba(239,68,68,.35)",cx,cy,r);
    drawZone(5,"rgba(245,158,11,.40)",cx,cy,r);
    drawZone(3,"rgba(34,197,94,.45)",cx,cy,r);
  }

  if(mode==="psychic"){
    drawNeedle(secret,"white",6,cx,cy,r);
  }

  if(mode==="team"){
    drawNeedle(currentNeedle,"white",6,cx,cy,r);
  }

  if(mode==="reveal"){
    drawNeedle(secret,"white",12,cx,cy,r);
    players.forEach(p=>{
      if(p.id===players[psychicIndex].id) return;
      if(guesses[p.id]!=null){
        drawNeedle(guesses[p.id],p.color,5,cx,cy,r);
      }
    });
  }
}

/* ===== SCORE ===== */
function points(g){
  const d=Math.abs(g-secret);
  if(d<=3) return 4;
  if(d<=5) return 2;
  if(d<=8) return 1;
  return 0;
}

function renderScores(){
  scoresDiv.innerHTML="";
  players.forEach((p,i)=>{
    scoresDiv.innerHTML+=`
      <div class="scoreline">
        <span>${p.name}${i===psychicIndex?" (Psychic)":""}</span>
        <b>${p.score} pts</b>
      </div>`;
  });
}

/* ===== FLOW ===== */
function update(){
  pairDiv.innerHTML=`<span class="pill">${roundPair[0]}</span><span class="pill">${roundPair[1]}</span>`;
  renderScores();

  if(phase==="psychic"){
    turnTitle.textContent="TOUR DU PSYCHIC";
    turnSub.textContent=`Secret : ${secret}`;
    sliderWrap.classList.add("hidden");
    draw("psychic");
    btn.textContent="Passer à l'équipe";
    btn.onclick=()=>{ phase="team"; update(); };
  }

  if(phase==="team"){
    sliderWrap.classList.remove("hidden");
    draw("team");
    btn.textContent="Valider";
    btn.onclick=()=>{
      const next=players.find(p=>p.id!==players[psychicIndex].id && guesses[p.id]==null);
      if(next){ guesses[next.id]=currentNeedle; }
      if(Object.keys(guesses).length===players.length-1){
        phase="reveal";
      }
      update();
    };
  }

  if(phase==="reveal"){
    sliderWrap.classList.add("hidden");
    draw("reveal");
    if(!roundScored){
      players.forEach(p=>{
        if(p.id!==players[psychicIndex].id){
          p.score+=points(guesses[p.id]);
        }
      });
      roundScored=true;
    }
    btn.textContent="Nouvelle manche";
    btn.onclick=()=>{
      psychicIndex=(psychicIndex+1)%players.length;
      secret=Math.floor(Math.random()*101);
      guesses={};
      roundScored=false;
      phase="psychic";
      update();
    };
  }
}

slider.oninput=e=>{
  currentNeedle=Number(e.target.value);
  draw("team");
};

update();
</script>
</body>
</html>