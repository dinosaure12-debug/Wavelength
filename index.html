<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Wavelength – Mobile</title>

<style>
:root{
  --bg:#0b1220;
  --panel:rgba(255,255,255,.06);
  --border:rgba(255,255,255,.14);
  --text:#f9fafb;
  --muted:rgba(255,255,255,.70);
  --accent:#f97316;
  --green:#22c55e;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(900px 500px at 20% 0%, rgba(249,115,22,.12), transparent 60%), var(--bg);
  color:var(--text);
  padding:12px;
  display:flex;
  justify-content:center;
}

.app{
  width:min(760px,100%);
  display:flex;
  flex-direction:column;
  gap:12px;
}

.panel{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
}

.turn{
  text-align:center;
  font-size:26px;
  font-weight:900;
}

.subturn{
  text-align:center;
  font-size:14px;
  color:var(--muted);
}

.pair{
  display:flex;
  justify-content:center;
  gap:12px;
  font-weight:900;
  font-size:18px;
}

.pill{
  padding:8px 14px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid var(--border);
}

canvas{
  width:100%;
  max-width:560px;
  margin:auto;
  display:block;
  border-radius:18px;
  background:rgba(0,0,0,.2);
  border:1px solid var(--border);
}

button{
  padding:12px 18px;
  border-radius:999px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.2);
  color:var(--text);
  font-weight:900;
  cursor:pointer;
}

button.primary{
  background:linear-gradient(180deg, #f97316, #fb923c);
  color:#111;
}

button.green{
  background:rgba(34,197,94,.25);
  border-color:rgba(34,197,94,.5);
}

.hidden{display:none}

.scoreline{
  display:flex;
  justify-content:space-between;
  padding:10px 12px;
  border-radius:12px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.2);
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div class="panel">
  <div class="turn" id="turnTitle">Configuration</div>
  <div class="subturn" id="turnSub"></div>
</div>

<!-- PAIR -->
<div class="panel">
  <div class="pair" id="pair"></div>
</div>

<!-- CANVAS -->
<div class="panel">
  <canvas id="canvas" width="800" height="500"></canvas>
</div>

<!-- ACTION -->
<div class="panel" style="text-align:center;">
  <button id="actionBtn" class="primary">Commencer</button>
</div>

<!-- SCORES -->
<div class="panel hidden" id="scoresPanel">
  <h3>Scores</h3>
  <div id="scores"></div>
</div>

</div>

<script>
/* ===================== CONFIG ===================== */
const PAIRS = [
 ["Rappeur inconnu","Rappeur légendaire"],
 ["Acteur éclaté","Acteur immense"],
 ["Jeu vidéo niche","Jeu vidéo mythique"],
 ["Punchline faible","Punchline assassine"],
 ["Ville éclatée","Ville incroyable"],
 ["Film chiant","Film addictif"],
 ["Humour gênant","Humour masterclass"]
];

/* ===================== STATE ===================== */
let players = [];
let psychicIndex = 0;
let phase = "setup"; // setup | psychic | team | reveal
let currentTeamIndex = 0;

let secret = 0;
let zone = 0;
let guesses = {};

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

/* ===================== UTILS ===================== */
const rand=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;

/* ===================== DRAW ===================== */
function draw(needle, showZone=false, showSecret=false){
 ctx.clearRect(0,0,800,500);
 const cx=400, cy=430, r=300;

 ctx.strokeStyle="rgba(255,255,255,.2)";
 ctx.lineWidth=60;
 ctx.beginPath();
 ctx.arc(cx,cy,r,Math.PI,0);
 ctx.stroke();

 if(showZone){
   const a1=Math.PI*(1-(secret-zone/2)/100);
   const a2=Math.PI*(1-(secret+zone/2)/100);
   ctx.strokeStyle="rgba(34,197,94,.35)";
   ctx.lineWidth=60;
   ctx.beginPath();
   ctx.arc(cx,cy,r,a2,a1);
   ctx.stroke();
 }

 const a=Math.PI*(1-needle/100);
 const nx=cx+Math.cos(a)*r;
 const ny=cy-Math.sin(a)*r;

 ctx.strokeStyle="#fff";
 ctx.lineWidth=6;
 ctx.beginPath();
 ctx.moveTo(cx,cy);
 ctx.lineTo(nx,ny);
 ctx.stroke();

 ctx.fillStyle="#fff";
 ctx.beginPath();
 ctx.arc(cx,cy,12,0,Math.PI*2);
 ctx.fill();

 if(showSecret){
   const as=Math.PI*(1-secret/100);
   ctx.fillStyle="#f97316";
   ctx.beginPath();
   ctx.arc(cx+Math.cos(as)*r, cy-Math.sin(as)*r, 8,0,Math.PI*2);
   ctx.fill();
 }
}

/* ===================== FLOW ===================== */
function startGame(){
 players = prompt("Pseudos séparés par des virgules").split(",").map(p=>({name:p.trim(),score:0}));
 psychicIndex = rand(0, players.length-1);
 nextRound();
}

function nextRound(){
 guesses={};
 secret=rand(0,100);
 zone=rand(18,26);
 currentTeamIndex=0;
 phase="psychic";
 updateUI();
}

function nextTeam(){
 do{ currentTeamIndex++; } 
 while(players[currentTeamIndex]?.isPsychic);
 if(currentTeamIndex>=players.length){
   phase="reveal";
 } else phase="team";
 updateUI();
}

function reveal(){
 Object.keys(guesses).forEach(id=>{
   const d=Math.abs(guesses[id]-secret);
   const pts=d<zone/4?4:d<zone/2?3:d<zone*0.75?2:d<zone?1:0;
   players[id].score+=pts;
 });
 psychicIndex=(psychicIndex+1)%players.length;
 nextRound();
}

/* ===================== UI ===================== */
const turnTitle=document.getElementById("turnTitle");
const turnSub=document.getElementById("turnSub");
const pairDiv=document.getElementById("pair");
const btn=document.getElementById("actionBtn");
const scoresDiv=document.getElementById("scores");
const scoresPanel=document.getElementById("scoresPanel");

function updateUI(){
 pairDiv.innerHTML=PAIRS[rand(0,PAIRS.length-1)].map(t=>`<span class="pill">${t}</span>`).join("↔");

 players.forEach((p,i)=>p.isPsychic=i===psychicIndex);

 if(phase==="psychic"){
   turnTitle.textContent="TOUR DU PSYCHIC";
   turnSub.textContent=players[psychicIndex].name;
   draw(secret,true,true);
   btn.textContent="Passer à l'équipe";
   btn.onclick=()=>{phase="team";updateUI();}
 }

 if(phase==="team"){
   const p=players.find((_,i)=>i!==psychicIndex && !guesses[i]);
   turnTitle.textContent="TOUR DE";
   turnSub.textContent=p.name;
   draw(50,false,false);
   btn.textContent="Valider mon placement";
   btn.onclick=()=>{
     guesses[players.indexOf(p)]=50;
     nextTeam();
   }
 }

 if(phase==="reveal"){
   turnTitle.textContent="RÉVÉLATION";
   turnSub.textContent="Résultats";
   draw(50,true,true);
   btn.textContent="Manche suivante";
   btn.onclick=reveal;

   scoresPanel.classList.remove("hidden");
   scoresDiv.innerHTML="";
   players.forEach(p=>{
     scoresDiv.innerHTML+=`<div class="scoreline"><b>${p.name}</b><span>${p.score}</span></div>`;
   });
 }
}

btn.onclick=startGame;
</script>
</body>
</html>